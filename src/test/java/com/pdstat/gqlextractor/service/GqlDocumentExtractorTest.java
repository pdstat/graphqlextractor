package com.pdstat.gqlextractor.service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.pdstat.gqlextractor.deserialiser.DocumentDeserialiser;
import com.pdstat.gqlextractor.extractor.GqlDocumentExtractor;
import com.pdstat.gqlextractor.graal.GraalAcornWalker;
import graphql.language.AstPrinter;
import graphql.language.Document;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.Spy;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.core.io.Resource;

import java.util.List;
import java.util.Set;

@ExtendWith(MockitoExtension.class)
public class GqlDocumentExtractorTest {

    private static final String VISITOR_STRING = "({\n" +
            "    VariableDeclarator: (node) => {\n" +
            "        if (node.init && node.init.type ===\n" +
            "            \"ObjectExpression\") {\n" +
            "            const kindProp = node.init.properties.find(prop => prop.key?.name ===\n" +
            "                \"kind\" && prop.value?.value === \"Document\");\n" +
            "            const definitionsProp =\n" +
            "                node.init.properties.find(prop => prop.key?.name === definitions && prop.value?.type ===\n" +
            "                    \"ArrayExpression\");\n" +
            "            if (kindProp && definitionsProp) {\n" +
            "                const extractedObject =\n" +
            "                    extractObjectFromAST(node.init);\n" +
            "                if (extractedObject) matchedObjects.push(extractedObject);\n" +
            "            }\n" +
            "        }\n" +
            "    },\n" +
            "    Literal: (node) => {\n" +
            "        if (node.value && typeof node.value === 'string' &&\n" +
            "            (node.value.indexOf('\"kind\"') > -1) && (node.value.indexOf('\"Document\"') > -1) &&\n" +
            "            (node.value.indexOf('\"definitions\"') > -1)) {\n" +
            "            matchedObjects.push(node.value);\n" +
            "        }\n" +
            "    }\n" +
            "})";

    @Mock
    private Resource gqlDocsVisitorResource;

    @Mock
    private GraalAcornWalker walker;
    
    @Mock
    private ResourceService resourceService;
    
    @Spy
    private ObjectMapper mapper = createObjectMapper();

    @InjectMocks
    private GqlDocumentExtractor gqlDocumentExtractor;

    private ObjectMapper createObjectMapper() {
        ObjectMapper objectMapper = new ObjectMapper();
        SimpleModule module = new SimpleModule();
        module.addDeserializer(Document.class, new DocumentDeserialiser());
        objectMapper.registerModule(module);
        return objectMapper;
    }

    @Test
    void testExtract() throws Exception {
        String javascript = "__d((function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,\"__esModule\"," +
                "{value:!0}),e.default=void 0;const n=JSON.parse(\"{\\\"kind\\\":\\\"Document\\\",\\\"definitions\\\"" +
                ":[{\\\"kind\\\":\\\"OperationDefinition\\\",\\\"operation\\\":\\\"query\\\",\\\"name\\\":{\\\"kind\\\"" +
                ":\\\"Name\\\",\\\"value\\\":\\\"AboutTheHostQuery\\\"},\\\"variableDefinitions\\\":[{\\\"kind\\\":\\\"" +
                "VariableDefinition\\\",\\\"variable\\\":{\\\"kind\\\":\\\"Variable\\\",\\\"name\\\":{\\\"kind\\\":\\\"" +
                "Name\\\",\\\"value\\\":\\\"listingId\\\"}},\\\"type\\\":{\\\"kind\\\":\\\"NonNullType\\\",\\\"type\\\":{\\\"" +
                "kind\\\":\\\"NamedType\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"ID\\\"}}},\\\"" +
                "directives\\\":[]}],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"" +
                "selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"node\\\"},\\\"" +
                "arguments\\\":[{\\\"kind\\\":\\\"Argument\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"" +
                "value\\\":{\\\"kind\\\":\\\"Variable\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"listingId\\\"}}}],\\\"" +
                "directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\"" +
                ":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"__typename\\\"},\\\"arguments\\\":" +
                "[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"InlineFragment\\\",\\\"typeCondition\\\":{\\\"kind\\\":\\\"NamedType\\\"," +
                "\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"StaySupplyListing\\\"}},\\\"directives\\\":[],\\\"" +
                "selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":" +
                "{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"" +
                "Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"primaryHostUser\\\"},\\\"arguments\\\":[],\\\"" +
                "directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"" +
                "Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"__typename\\\"},\\\"arguments\\\":[],\\\"" +
                "directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"" +
                "arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"" +
                "value\\\":\\\"passportCardData\\\"},\\\"arguments\\\":[],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"" +
                "SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"" +
                "__typename\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"" +
                "Name\\\",\\\"value\\\":\\\"profilePictureUrl\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]}]}}]}}]}}]}}]}}],\\\"" +
                "operationType\\\":\\\"QUERY\\\"}\");n.operationId=\"b7f71b5f3b79384fb6de81062cac9513ac2696c2cced6e14d703a56724fffde4\"," +
                "n.integrityHash=\"33cd9c221c3f68609924ca351c82dc03b63a69a81c3b3601a5d5ce7bf2cf9f62\";e.default=n}),\"111209\",[]);\n" +
                "//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/" +
                "user-profile-next/api/AboutTheHostQuery-document.niobe.dbccc0acf3.js.map";

//        String documentJson = "[\"{\\\"kind\\\":\\\"Document\\\",\\\"definitions\\\":[{\\\"kind\\\":\\\"OperationDefinition\\\",\\\"operation\\\":\\\"query\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"AboutTheHostQuery\\\"},\\\"variableDefinitions\\\":[{\\\"kind\\\":\\\"VariableDefinition\\\",\\\"variable\\\":{\\\"kind\\\":\\\"Variable\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"listingId\\\"}},\\\"type\\\":{\\\"kind\\\":\\\"NonNullType\\\",\\\"type\\\":{\\\"kind\\\":\\\"NamedType\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"ID\\\"}}},\\\"directives\\\":[]}],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"node\\\"},\\\"arguments\\\":[{\\\"kind\\\":\\\"Argument\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"value\\\":{\\\"kind\\\":\\\"Variable\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"listingId\\\"}}}],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"__typename\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"InlineFragment\\\",\\\"typeCondition\\\":{\\\"kind\\\":\\\"NamedType\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"StaySupplyListing\\\"}},\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"primaryHostUser\\\"},\\\"arguments\\\":[],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"__typename\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"id\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"passportCardData\\\"},\\\"arguments\\\":[],\\\"directives\\\":[],\\\"selectionSet\\\":{\\\"kind\\\":\\\"SelectionSet\\\",\\\"selections\\\":[{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"__typename\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]},{\\\"kind\\\":\\\"Field\\\",\\\"name\\\":{\\\"kind\\\":\\\"Name\\\",\\\"value\\\":\\\"profilePictureUrl\\\"},\\\"arguments\\\":[],\\\"directives\\\":[]}]}}]}}]}}]}}]}}],\\\"operationType\\\":\\\"QUERY\\\"}\"]";

//        String documentJson = "[{\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"name\":{\"kind\":\"Name\",\"value\":\"createInstance\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"CreateInstanceInput\"}}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"createInstance\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"instance\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"instanceFull\"}}]}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"instanceFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Instance\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"clientId\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"createdAt\"}}]}}]},{\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"name\":{\"kind\":\"Name\",\"value\":\"createTeam\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"CreateTeamInput\"}}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"createTeam\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"team\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"teamMeta\"}}]}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"teamMeta\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Team\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"__typename\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"email\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"plan\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"}}]}}]}}]},{\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"name\":{\"kind\":\"Name\",\"value\":\"updateTeamSeats\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}}},{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"amount\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Int\"}}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"updateTeamSeats\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"amount\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"amount\"}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"subscription\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"teamSubscriptionFull\"}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"error\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"UnknownIdUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"unknownIdUserErrorFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"InvalidAmountUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"invalidAmountUserErrorFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"PaymentFailedUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"paymentFailedUserErrorFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"InternalUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"internalUserErrorFull\"}}]}}]}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"teamSubscriptionMeta\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"TeamSubscription\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"planFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Plan\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataPaddleFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataPaddle\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"cancelUrl\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"nextBillAmount\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"nextBillDate\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"status\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"updateUrl\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataInvoiceFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataInvoice\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"_\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataStudentFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataStudent\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"_\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataPartnerFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataPartner\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataInternalFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataInternal\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"_\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataIntegrationFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataIntegration\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"platform\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataComplimentaryFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataComplimentary\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"reason\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadata\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"__typename\"}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataPaddle\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataPaddleFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataInvoice\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataInvoiceFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataStudent\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataStudentFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataPartner\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataPartnerFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataInternal\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataInternalFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataIntegration\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataIntegrationFull\"}}]}},{\"kind\":\"InlineFragment\",\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"SubscriptionMetadataComplimentary\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataComplimentaryFull\"}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"userErrorFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"UserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"__typename\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"code\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"teamSubscriptionFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"TeamSubscription\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"teamSubscriptionMeta\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"endsAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"pausesAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"startsAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"plan\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"planFull\"}}]}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"seats\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"metadata\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"subscriptionMetadataFull\"}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"unknownIdUserErrorFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"UnknownIdUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"userErrorFull\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"invalidAmountUserErrorFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"InvalidAmountUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"userErrorFull\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"max\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"min\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"paymentFailedUserErrorFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"PaymentFailedUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"userErrorFull\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"reason\"}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"internalUserErrorFull\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"InternalUserError\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"userErrorFull\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"message\"}}]}}]},{\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"name\":{\"kind\":\"Name\",\"value\":\"inviteTeamUser\"},\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"ID\"}}}},{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"InviteTeamUserInput\"}}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"inviteTeamUser\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}},{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"input\"}}}],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"invitation\"},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"FragmentSpread\",\"name\":{\"kind\":\"Name\",\"value\":\"teamUserInvitationMeta\"}}]}}]}}]}},{\"kind\":\"FragmentDefinition\",\"name\":{\"kind\":\"Name\",\"value\":\"teamUserInvitationMeta\"},\"typeCondition\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"TeamUserInvitation\"}},\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"__typename\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"email\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"createdAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"expiresAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"updatedAt\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"role\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"inviterEmail\"}},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"teamName\"}}]}}]}]";

        String documentJson = "[\"query GetUserUUID {    user {      uuid    }  }\",\n" +
                "    \"mutation vehiclesCreateDocument(    $documentTypeUuid: String    $entityType: String    $entityUUID: String    $file: Upload!    $fileType: String    $orgUUID: String  ) {    createDocument(      documentTypeUuid: $documentTypeUuid      entityType: $entityType      entityUUID: $entityUUID      file: $file      fileType: $fileType      orgUUID: $orgUUID    ) {      uuid    }  }\",\n" +
                "    \"mutation deleteVehicle($vehicleUUID: String, $orgUUID: String) {    deleteVehicle(vehicleUUID: $vehicleUUID, orgUUID: $orgUUID) {      _    }  }\",\n" +
                "    \"query vehicleManagementFindRenter($orgUUID: ID!, $criteria: FindRenterCriteria__Input) {    findRenter(orgUUID: $orgUUID, criteria: $criteria) {      user {        uuid        name {          firstName          lastName        }        pictureUrl        email        phone {          countryCode          nationalPhoneNumber        }        driverInfo {          completedTripsCount          recognitionRating          flowType        }      }      vehicleRentalEligibility {        isEligible        message        blockRentalAssignment      }      teslaRentalEligible    }  }\",\n" +
                "    \"query vehicleManagementGetTermsForSupplier(    $orgUUID: ID!    $searchFilters: GetTermsForSupplierSearchFilters__Input    $pageInfo: PageInfo__Input  ) {    getTermsForSupplier(orgUUID: $orgUUID, searchFilters: $searchFilters, pageInfo: $pageInfo) {      terms {        recipientUUID        termsUUID        vehicleUUID        state        driver {          pictureUrl          firstName          lastName          mobileCountryCode          mobile          email        }      }    }  }\",\n" +
                "    \"query getVehicle($orgUUID: String!, $vehicleUUID: ID!) {    getSupplierVehicle(orgUUID: $orgUUID, vehicleUUID: $vehicleUUID) {      uuid      make      makeTranslationKey      localizedMake      model      localizedModel      modelTranslationKey      year      licensePlate      vin      color      colorNameTranslationKey      localizedColorName      colorHexCode      imageURL      compliance {        status        documents {          documentTypeUUID          documentTypeName          status          expiresAt          statusReasonName          isBlanketDocument          isOptionalDocument          onboardingStatus          onboardingStatusReasonName        }      }      assignments {        entityUUID      }      labels {        value      }    }  }\",\n" +
                "    \"mutation CreateOffer($offer: OfferInput!) {    createOffer(offer: $offer) {      ...CreateListingFragment    }  } fragment CreateListingFragment on Offer {    uuid    name    status    effectiveFrom    updatedAt    draftInfo {      draftEnabled      draftMetadata    }    catalogPhoto {      id      cdnUrl    }    amount {      id      amount      normalizedAmount      cadence      currency      model      coefficient      displayAmount      displayName    }    offerData {      id      amount      cadence      benefits      requirements      isCategoryOffer      customContent {        id        content        title        type      }      priceBreakdown {        id        type        label        value      }      vehicle {        id        uuid        make        model        year        fuelType        mileage        offerDetails        depositAmount        transmission      }      availability {        allTimeAccess        needReturnVehicleAtTheEndOfTheDay      }      pickupLocation {        coordinate {          latitude          longitude        }        address {          name          street1          street2          city          postalCode          countryIso2          countrySubdivision        }      }    }    bookingMethods {      id      medium      target    }    vehicle {      uuid      licensePlate      labels {        value      }      vin      imageURL      imageURL500      compliance {        status      }    }    product {      ...ListingsTableProduct    }    placement {      id      l1Uuid      l2Uuid      l3Uuid    }    supplier {      uuid      name      joinDate      supplierLogo {        id        cdnUrl        url      }    }  }\",\n" +
                "    \"query GetFleetDrivers($orgUUID: String!) {    getFleetDrivers(orgUUID: $orgUUID) {      uuid      name      mobile      pictureUrl      onboardingStatus      email    }  }\"]";

        Mockito.when(resourceService.readResourceFileContent(gqlDocsVisitorResource)).thenReturn(VISITOR_STRING);
        Mockito.when(walker.extractMatchedObjects(javascript, VISITOR_STRING)).thenReturn(documentJson);

        List<Document> documents = gqlDocumentExtractor.extract(javascript);
        documents.forEach(doc -> {
            String ast = AstPrinter.printAst(doc);
            System.out.println(ast);
        });
    }
}
